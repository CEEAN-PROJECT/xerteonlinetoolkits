<link title="timeline-styles" rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">

<script type="text/javascript">

	// NEW PAGE MODELS SHOULD BE BASED ON THIS TEMPLATE
	// ------------------------------------------------
	// change lines 10 and 28 below so that "pageName" matches the unique name of the page in the xwd
	// save this file to models_html5 as pageName.html

	// pageChanged & sizeChanged functions are needed in every model file
	// other functions for model should also be in here to avoid conflicts
	var SictTimeline = new function() {

		this.loadJS = function () {

			$('<link/>', {
				rel: 'stylesheet',
				type: 'text/css',
				href:  x_templateLocation + 'common_html5/js/timeline/timeline3.css'
			}).appendTo('head');

			if (numLoaded < 1) {
				var fileToLoad;
				if (numLoaded == 0) {
					fileToLoad = x_templateLocation + 'common_html5/js/timeline/timeline3.js';
				}

				$.getScript(fileToLoad)
						.done(function(script, textStatus) {
							numLoaded++;
							SictTimeline.loadJS();
						})
						.fail(function( jqxhr, settings, exception ) {
							console.log('Failed to load chart scripts');
						});
			}else{
				this.setup();

			}
		}

		this.setup = function (){

			var make_the_json = {
				title: {
					media: {
						url: x_currentPageXML.getAttribute("url"),
						caption: x_currentPageXML.getAttribute("tip"),
					},
					text: {
						headline: x_currentPageXML.getAttribute("name"),
						text: '<p>' + x_currentPageXML.getAttribute("text") +'</p>'
					}
				},
				events: $(x_currentPageXML).children().map(function (index, element) {
					var startDate = element.getAttribute("date");
					var endDate = element.getAttribute("endDate");

					var startTime = element.getAttribute("time");
					var endTime = element.getAttribute("endTime")

					var validStart = /^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(startTime)
					var validEnd = /^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(endTime)

					if(startTime === null || !validStart){
						startTime = "00:00"
					}
					if(endTime === null || !validEnd){
						endTime = "00:00"
					}
					if(endDate === null || endDate === undefined){
						endDate = startDate
					}


					return {
						media: {
							url: element.getAttribute("url"),
							caption: element.getAttribute("tip"),
						},
						start_date: {
							month: element.getAttribute("date").substring(5, 7),
							day: element.getAttribute("date").substring(8, 10),
							year: element.getAttribute("date").substring(0, 4),
							hour: startTime.substring(0, 2),
							minute: startTime.substring(3,5)
						},
						end_date:{
							month: endDate.substring(5, 7),
							day: endDate.substring(8, 10),
							year: endDate.substring(0, 4),
							hour: endTime.substring(0, 2),
							minute: endTime.substring(3, 5)
						},
						text: {
							headline: element.getAttribute("name"),
							text: element.getAttribute("text")
						}
					}
				}).get()
			};
			console.log(make_the_json);
			var timeline_json = make_the_json; // replace make_the_json() with the JSON object you created
			// two arguments: the id of the Timeline container (no '#')
			// and the JSON object or an instance of TL.TimelineConfig created from
			// a suitable JSON object
			window.timeline = new TL.Timeline('timeline-embed', timeline_json);
			setTimeout(function (){
				SictTimeline.resizeImg();

			}, 1500);
		}

		// function called every time the page is viewed after it has initially loaded
		this.pageChanged = function() {
			setTimeout(function (){
				SictTimeline.resizeImg();

			}, 1500);
		}

		// function called every time the size of the LO is changed
		this.sizeChanged = function() {
				SictTimeline.resizeImg();

		}



		this.init = function() {
			numLoaded = 0;
			this.loadJS();

			// $("#")
			// call this function in every model once everything's loaded
			x_pageLoaded();

		}

		this.resizeImg = function() {

			var imgMaxW, imgMaxH;

			imgMaxW = Math.round($x_pageHolder.width() * 0.55 - 20);
			imgMaxH = Math.round($x_pageHolder.height() - 50);

			var big;
			var normal;
			var small;
			var arrow;
			var img = document.getElementsByClassName("tl-media-item")

			big = imgMaxH*0.7
			normal = imgMaxH*0.6
			small = imgMaxH*0.5
			arrow = small*0.5
			big = big.toString()
			normal = normal.toString()
			small = small.toString()
			arrow = arrow.toString()



			for(var i =0; i < img.length; i++){

				if(img[i].src !== ""){
					//document.getElementById("timeline-embed").style = "height: " + height + "px !important;"
					//document.getElementsByClassName("tl-storyslider").style = "height: " + imgMaxH + "px !important;"
					$("#timeline-embed").css("height", big)
					$(".tl-storyslider").css("height", big)
					$(".tl-media-content-container").css("height", small)
					$(".tl-media").css("height", small)
					$(".tl-media-content").css("height", small)

					//arrow ajustment
					$(".tl-slidenav-next").css("top", arrow)


					img[i].style = "max-height: "+small+"px; !important"
				}else{
					$("#timeline-embed").css("height", big)
					$(".tl-storyslider").css("height", big)
					$(".tl-media-content-container").css("height", small)
					$(".tl-media").css("height", small)
					$(".tl-media-content").css("height", small)

					//arrow ajustment
					$(".tl-slidenav-next").css("top", arrow)

					img[i].style = "max-height: "+small +"px; !important"
					img[i].style = "width: 30%; !important"
				}

			}
			debugger
			console.log(imgMaxH)
			console.log(big)
			console.log(normal)
			console.log(small)

		};
	}



	SictTimeline.init();

</script>


<style type="text/css">

</style>


<div id="pageContents">
	<div id='timeline-embed' style="width: 100%; height: 500px"></div>
</div>
